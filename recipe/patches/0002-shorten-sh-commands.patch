From 716f4bc96ebe350aaa110cbf7b9cbc560ff0c8b7 Mon Sep 17 00:00:00 2001
From: Kerry Su <me@sshockwave.net>
Date: Sun, 20 Nov 2022 15:27:21 +0800
Subject: [PATCH 2/2] shorten sh commands

---
 GNUmakefile | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/GNUmakefile b/GNUmakefile
index d6d4b2103..0caa6cd4e 100644
--- a/GNUmakefile
+++ b/GNUmakefile
@@ -352,13 +352,15 @@ completions: build-coreutils
 		$(BUILDDIR)/coreutils completion $(prog) fish > $(BUILDDIR)/completions/fish/$(PROG_PREFIX)$(prog).fish; \
 	)
 
+SYS_LN := "$(shell command -v ln 2> /dev/null)"
 install: build manpages completions
 	mkdir -p $(INSTALLDIR_BIN)
 ifeq (${MULTICALL}, y)
 	$(INSTALL) $(BUILDDIR)/coreutils $(INSTALLDIR_BIN)/$(PROG_PREFIX)coreutils
-	cd $(INSTALLDIR_BIN) && $(foreach prog, $(filter-out coreutils, $(INSTALLEES)), \
-		ln -fs $(PROG_PREFIX)coreutils $(PROG_PREFIX)$(prog) &&) :
-	$(if $(findstring test,$(INSTALLEES)), cd $(INSTALLDIR_BIN) && ln -fs $(PROG_PREFIX)coreutils $(PROG_PREFIX)[)
+	cd "$(INSTALLDIR_BIN)" && for prog in $(filter-out coreutils, $(INSTALLEES)); do \
+		$(SYS_LN) -fs $(PROG_PREFIX)coreutils$(PROG_SUFFIX) $(PROG_PREFIX)$$prog$(PROG_SUFFIX); done;
+	$(if $(findstring test,$(INSTALLEES)), cd "$(INSTALLDIR_BIN)" && \
+		$(SYS_LN) -fs $(PROG_PREFIX)coreutils$(PROG_SUFFIX) $(PROG_PREFIX)[$(PROG_SUFFIX))
 else
 	$(foreach prog, $(INSTALLEES), \
 		$(INSTALL) $(BUILDDIR)/$(prog) $(INSTALLDIR_BIN)/$(PROG_PREFIX)$(prog);)
@@ -369,6 +371,7 @@ endif
 		$(INSTALL) $(BUILDDIR)/man/$(PROG_PREFIX)$(prog).1 $(DESTDIR)$(DATAROOTDIR)/man/man1/; \
 	)
 
+completion:
 	mkdir -p $(DESTDIR)$(DATAROOTDIR)/zsh/site-functions
 	mkdir -p $(DESTDIR)$(DATAROOTDIR)/bash-completion/completions
 	mkdir -p $(DESTDIR)$(DATAROOTDIR)/fish/vendor_completions.d
